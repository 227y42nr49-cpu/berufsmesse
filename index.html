<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gewinnspiel Fortschritt</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/dist/supabase.min.js"></script>
<script src="data.js"></script>

<style>
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background:linear-gradient(135deg,#1e3c72,#2a5298); color:white; margin:0; text-align:center; padding:50px 20px;}
.container { background:rgba(255,255,255,0.1); border-radius:20px; padding:40px; max-width:400px; margin:auto; box-shadow:0 10px 25px rgba(0,0,0,0.3); }
h1 { font-size:28px; margin-bottom:20px; }
#participantId { font-weight:bold; font-size:20px; color:#00ff99; }
.progress { font-size:22px; margin-top:20px; }
.stand-list { text-align:left; margin-top:20px; }
.stand-list li { margin-bottom:5px; }
</style>
</head>
<body>
<div class="container">
<h1>ðŸŽ¯ Dein Fortschritt</h1>
<p>Deine Teilnehmer-ID: <span id="participantId">LÃ¤dtâ€¦</span></p>
<p class="progress">Besuchte StÃ¤nde: <span id="count">0</span> / 71</p>
<ul class="stand-list" id="visitedStands"></ul>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function(){
let participantId = localStorage.getItem("participantId");
if(!participantId){
  participantId = "T-"+Math.random().toString(36).substring(2,8).toUpperCase();
  localStorage.setItem("participantId", participantId);
}
document.getElementById("participantId").innerText = participantId;

const SUPABASE_URL = "https://jxrmhslzokgezakboufx.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ5fsmMl_DMOtze9ztqn9PGlsg0I";
const supabase = Supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

const { data: visits, error } = await supabase.from('visits').select('*').eq('participant_id', participantId);
if(error){ console.error(error); return; }

document.getElementById("count").innerText = visits.length;
const listEl = document.getElementById("visitedStands");
listEl.innerHTML = "";
visits.forEach(v=>{
  const li = document.createElement("li");
  li.textContent = `Stand ${v.stand_id}: ${stands[v.stand_id]?.name || v.stand_id}`;
  listEl.appendChild(li);
});
});
</script>
</body>
</html>
