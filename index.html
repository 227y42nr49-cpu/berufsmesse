<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Berufsmesse Fortschritt</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.10.0/dist/supabase.min.js"></script>
<script src="data.js"></script>
<script>
  const SUPABASE_URL = "https://jxrmhslzokgezakboufx.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4cm1oc2x6b2tnZXpha2JvdWZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NTg3OTMsImV4cCI6MjA4NTUzNDc5M30.wskrw2Qvp2FbNCFJ5SfsmMl_DMOtze9ztqn9PGlsg0I";
  const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
</script>
</head>
<body>
<h1>üéì Berufsmesse 2026</h1>

<p>
Teilnehmer-ID: <strong id="participantId"></strong><br>
Besuchte St√§nde: <strong id="count">0</strong>
</p>

<button onclick="downloadCSV()">‚¨áÔ∏è CSV herunterladen</button>

<script>
if(!localStorage.getItem("participantId")){
    const id = "T-" + Math.random().toString(36).substring(2,8).toUpperCase();
    localStorage.setItem("participantId", id);
}

document.getElementById("participantId").innerText = localStorage.getItem("participantId");

async function loadProgress(){
    const participantId = localStorage.getItem("participantId");
    const { data, error } = await supabase
        .from('visits')
        .select('stand_id')
        .eq('participant_id', participantId);
    if(data) document.getElementById("count").innerText = data.length;
}

loadProgress();

function downloadCSV(){
    const participantId = localStorage.getItem("participantId");
    supabase
        .from('visits')
        .select('stand_id')
        .eq('participant_id', participantId)
        .then(({ data, error }) => {
            let csv = "participant_id,stand_id\n";
            data.forEach(row => { csv += participantId + "," + row.stand_id + "\n"; });
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `berufsmesse_${participantId}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });
}
</script>
</body>
</html>
